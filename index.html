<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>虚拟报税练习</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 400px; margin: 0 auto; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; box-sizing: border-box; }
        .button { background-color: #4CAF50; color: white; padding: 10px; border: none; cursor: pointer; width: 100%; }
        .result { margin-top: 20px; padding: 10px; background-color: #f9f9f9; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h2>增值税申报练习</h2>
        <div class="input-group">
            <label for="sales">销售额（不含税，万元）：</label>
            <input type="number" id="sales" placeholder="请输入销售额">
        </div>
        <div class="input-group">
            <label for="input-tax">进项税额（万元）：</label>
            <input type="number" id="input-tax" placeholder="请输入进项税额">
        </div>
        <button class="button" onclick="calculateTax()">计算应纳税额</button>
        <div class="result" id="result"></div>
    </div>

    <!-- 调整 Firebase SDK 加载顺序 -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

    <script>
        // Firebase 配置（需确保与控制台完全一致）
        const firebaseConfig = {
            apiKey: "AIzaSyCMXpULh1-1NenIdQ1KFSAk3feWnIia_Yo",
            authDomain: "tax-calculator-bd4f1.firebaseapp.com",
            projectId: "tax-calculator-bd4f1",
            storageBucket: "tax-calculator-bd4f1.firebasestorage.app",
            messagingSenderId: "1082903305997",
            appId: "1:1082903305997:web:54bdad860c32eb205f1a44"
        };

        // 初始化 Firebase（确保在 SDK 加载后执行）
        let db; // 将 db 声明为全局变量
        try {
            const app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log("Firebase 初始化成功！");
            console.log("Firebase 实例:", firebase.app().name); // 验证初始化
        } catch (error) {
            console.error("Firebase 初始化失败:", error);
        }

        function calculateTax() {
            const sales = parseFloat(document.getElementById('sales').value);
            const inputTax = parseFloat(document.getElementById('input-tax').value);

            if (isNaN(sales) || isNaN(inputTax)) {
                document.getElementById('result').innerHTML = "<p style='color: red;'>请输入有效数字！</p>";
                return;
            }

            const outputTax = sales * 0.13;
            const taxPayable = outputTax - inputTax;

            document.getElementById('result').innerHTML = `
                <p>销项税额：${outputTax.toFixed(2)} 万元</p>
                <p>应纳税额：${taxPayable.toFixed(2)} 万元</p>
                <p style="color: ${taxPayable >= 0 ? 'green' : 'red'};">${taxPayable >= 0 ? '正确！' : '错误！进项税额不能大于销项税额。'}</p>
            `;

            // 添加写入前检查
            if (typeof db === 'undefined') {
                console.error("Firestore 未初始化！");
                return;
            }

            // 写入数据（添加错误处理）
            db.collection("logs").add({
                sales: sales,
                inputTax: inputTax,
                outputTax: outputTax,
                taxPayable: taxPayable,
                timestamp: new Date().toISOString()
            })
            .then((docRef) => {
                console.log("文档已保存，ID:", docRef.id);
            })
            .catch((error) => {
                console.error("保存失败:", error);
                document.getElementById('result').innerHTML += "<p style='color: red;'>数据保存失败，请检查控制台！</p>";
            });
        }
    </script>
</body>
</html>
